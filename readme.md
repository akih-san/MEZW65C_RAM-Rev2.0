工事中＜Under construction＞
# MEZW65C_RAM ファームウェア Rev2.0
![photo 1](photo/Rev2.0_Opening.png)

# Rev2.0を作成した経緯

2024年8月にRev1.2を公開しましたが、ソフトウェアがW65C02用のユニバーサルモニタと<br>
Eh-BASIC、それから、W65C816用のネイティブモニタの３つしかありませんでした。<br>
そして、各ソフトを切り替えるには、リセットが必要でした。<br>
https://github.com/akih-san/MEZW65C_RAM<br>
<br>

![photo 2](photo/Rev1.2.png)

当初は、レガシーＯＳの移植を検討していたのですが、W65C816を生かしたものが見当たり<br>
ません。せっかくW65C816が動くのですから、もう少しネイティブモードで動くものが欲しい。<br>
また、レガシーＯＳは、ＯＳ専用のディスクイメージが必要となり、ソフトをクロス上で<br>
作成しても、ディスクイメージに落とし込む作業が、ちょっと面倒な点でした。<br>
<br>
折角ＳＤカードを使うのですから、FAT32でファイルを管理して、もっと手軽に<br>
W65C02/W65C816用に作ったプログラムで遊びたい・・・<br>
<br>
そんな思いで、Rev2,0のファームウェアを作成しました。<br>
<br>
# Rev2.0の特徴

Rev2.0では、クロス環境で作成したプログラムをFAT32のSDカードにコピーするだけで、<br>
MEZW65C_RAM上でプログラムを動作させることが出来ます。<br>
W65C816の機能を堪能するには十分だと思います。もちろん、W65C02でも十分に楽しむ<br>
ことが出来ます。<br>
<br>
＜ファイルの管理＞<br>
<br>
ファイル管理にfatfsを利用しています。また、階層ディレクトリにも対応しています。<br>

![photo 3](photo/dir.png)

Rev2.0では、W65C02とW65C816のプログラムを管理するために、ファイルの先頭に32バイト<br>
のファイルヘッダを設けております。この為、Rev1.2のプログラムをRev2.0で動かすことは<br>
出来ません。<br>
ファイルヘッダは、ソースプログラムで組み込みますが、サンプルのソースがありますので、<br>
それを使って作成します。<br>
<br>
ファイルヘッダを持たない、生データのバイナリファイルを利用する場合は、LOADコマンド<br>
にLOADアドレスを指示することで、強制的にメモリ上に生データを展開することも出来ます。<br>

![photo 4](photo/load_cmd.png)

<br>
ファイルのライト機能はありません。基本的にクロス環境で作成したプログラムを実行する<br>
ことを想定しており、MEZW65C_RAMでデータを作成し、外部にエクスポートすることは無い<br>
と思ってます。<br>
（今後、そういった状況が発生することがあれば対応を考えますが・・多分無いでしょう。）<br>
<br>
＜ファイル名＞<br>
<br>
ロングファイル名には対応していません。ファイル名は8文字＋拡張子になります。Rev2.0は<br>
ファイルヘッダ情報でファイルを管理するため拡張子は意味を持っていません。<br>
視覚的な認識として、プログラマーが好きに使用することになります。<br>
<br>

![photo 5](photo/filename.png)

<br>
＜モニタープログラムの常駐（BIOSコールの実装）＞<br>
<br>
BIOSコールを実装するために、モニタープログラムが常駐しています。ネイティブモニタと、<br>
エミュレーションモニタの２つが用意されています。W65C02使用時はエミュレーションモニタ<br>
が使用されます。<br>
W65C816使用時は、起動直後はネイティブモニタが常駐しますが、エミュレーションモニタを<br>
リロードすることで、W65C02のプログラムを動作させることが出来ます。<br>
<br>
Rev2.0は、実行させるプログラムのファイル情報でネイティブか、W65C02用かを見分けることが<br>
出来るため、必要とあればモニターのリロードを自動で実施するので、手動でモニターをリロード<br>
する必要はありません。<br>
手動でリロードすることも出来ます。ほとんどの場合、モニタプログラムでユーザー作成のプログ<br>
ラムをデバッグする時に、使用することでしょう。<br>
<br>
# クロス開発環境
<br>
・WDCTools<br>
<br>
The Western Design Center, Inc.が提供しているアセンブラ、cコンパイラを含む統合開発環境<br>
https://wdc65xx.com/WDCTools<br>
<br>
・CC65<br>
<br>
フリーで現役の6502用Cコンパイラです。<br>
https://cc65.github.io/<br>
<br>
・bin2mot.exe、mot2bin.exe<br>
<br>
モトローラフォーマットのヘキサファイルとバイナリファイル相互変換ツール<br>
ソースとバイナリファイルは、ここから入手できます。<br>
https://sourceforge.net/projects/bin2mot/files/
<br>
・xa (xa65) Version 2.4.1 <br>
6502用の2 パス ポータブル クロス アセンブラです。<br>
https://www.floodgap.com/retrotech/xa/<br>
<br>
・ASW,ASL<br>
沢山のCPUに対応したマクロアセンブラ<br>
http://john.ccac.rwth-aachen.de:8000/as/<br>
<br>

